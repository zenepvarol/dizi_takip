<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Series Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .cast-row { display: flex; gap: 10px; margin-bottom: 5px; }
        .card-container { display: flex; flex-wrap: wrap; gap: 15px; }
        .card { width: 150px; height: 280px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; text-align: center; flex-shrink: 0; padding: 5px; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card .title { font-weight: bold; margin-top: 5px; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card .subtitle { font-size: 14px; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .actor-card { width: 150px; height: 280px; text-align: center; margin: 5px; display: inline-block; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; padding: 5px; }
        .actor-card img { width: 100%; height: 180px; object-fit: cover; border-radius: 5px; }
        .actor-card .name { font-weight: bold; margin-top: 5px; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .actor-card .year { font-size: 14px; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h1 class="mb-4">Admin Panel</h1>

    <!-- Add Series -->
    <h3>Add Series</h3>
    <form method="POST" action="/admin">
        <input type="text" name="dizi_ad" class="form-control mb-2" placeholder="Series Name" required>
        <input type="text" name="afis_url" class="form-control mb-2" placeholder="Poster URL">
        <input type="number" name="yil" class="form-control mb-2" placeholder="Year">
        <input type="text" name="tur" class="form-control mb-2" placeholder="Genre">

        <h5>Cast</h5>
        <div id="castContainer">
            <div class="cast-row">
                <input type="text" name="oyuncu_ad[]" class="form-control" placeholder="Actor Name" required>
                <input type="text" name="karakter_ad[]" class="form-control" placeholder="Character Name" required>
                <input type="text" name="karakter_resim[]" class="form-control" placeholder="Character Image URL">
            </div>
        </div>
        <button type="button" class="btn btn-secondary mb-2" id="addCastBtn">+ Add Actor</button>
        <button type="submit" class="btn btn-primary w-100">Save Series</button>
    </form>

    <hr>

    <!-- Add Actor -->
    <h3>Add Actor</h3>
    <form method="POST" action="/admin">
        <input type="text" name="oyuncu_ad" class="form-control mb-2" placeholder="Actor Name" required>
        <input type="number" name="dogum_yil" class="form-control mb-2" placeholder="Birth Year">
        <input type="text" name="foto_url" class="form-control mb-2" placeholder="Actor Image URL">
        <button type="submit" class="btn btn-success w-100">Save Actor</button>
    </form>

    <hr>

    <!-- Existing Series -->
    <h3>Existing Series</h3>
    <div class="card-container">
        {% for d in diziler %}
        <div class="card">
            <a href="{{ url_for('dizi_detay', dizi_id=d['id']) }}">
                <img src="{{ d['afis_url'] }}" alt="Poster">
                <div class="title">{{ d['dizi_ad'] }}</div>
                <div class="subtitle">{{ d['tur'] }} ({{ d['yil'] }})</div>
            </a>
            <button class="btn btn-sm btn-danger mt-2 delete-dizi" data-id="{{ d['id'] }}">Delete</button>
        </div>
        {% endfor %}
    </div>

    <hr>

    <!-- Existing Actors -->
    <h3>Existing Actors</h3>
    <div class="card-container">
        {% for o in oyuncular %}
        <div class="actor-card">
            {% if o['foto_url'] %}
                <img src="{{ o['foto_url'] }}" alt="{{ o['ad'] }}">
            {% else %}
                <div class="bg-secondary" style="width:100%; height:180px;"></div>
            {% endif %}
            <div class="name">{{ o['ad'] }}</div>
            <div class="year">{{ o['dogum_yil'] if o['dogum_yil'] else '-' }}</div>
            <button class="btn btn-sm btn-warning mt-1 delete-oyuncu" data-id="{{ o['id'] }}">Delete</button>
        </div>
        {% endfor %}
    </div>

</div>

<script>
const addBtn = document.getElementById("addCastBtn");
const castContainer = document.getElementById("castContainer");

addBtn.addEventListener("click", () => {
    const row = document.createElement("div");
    row.classList.add("cast-row");
    row.innerHTML = `
        <input type="text" name="oyuncu_ad[]" class="form-control" placeholder="Actor Name" required>
        <input type="text" name="karakter_ad[]" class="form-control" placeholder="Character Name" required>
        <input type="text" name="karakter_resim[]" class="form-control" placeholder="Character Image URL">
    `;
    castContainer.appendChild(row);
});

// DELETE - SERIES
document.querySelectorAll(".delete-dizi").forEach(btn => {
    btn.addEventListener("click", function(event) {
        event.preventDefault();
        const diziId = this.getAttribute("data-id");

        fetch(`/dizi_sil/${diziId}`, { method: "POST" })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    this.parentElement.remove();
                }
            });
    });
});

// DELETE - ACTORS
document.querySelectorAll(".delete-oyuncu").forEach(btn => {
    btn.addEventListener("click", function(event) {
        event.preventDefault();
        const oyuncuId = this.getAttribute("data-id");

        fetch(`/oyuncu_sil/${oyuncuId}`, { method: "POST" })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    this.parentElement.remove();
                }
            });
    });
});
</script>
</body>
</html>
